=== QUERY ===
SELECT lineitem.orderkey, sum(lineitem.extendedprice * 1 - lineitem.discount) AS revenue, orders.orderdate, orders.shippriority FROM customer, orders, lineitem WHERE customer.mktsegment = 'BUILDING' AND customer.custkey = orders.custkey AND lineitem.orderkey = orders.orderkey AND orders.orderdate < DATE('1995-03-15') AND lineitem.shipdate > DATE('1995-03-15') GROUP BY lineitem.orderkey, orders.orderdate, orders.shippriority ORDER BY revenue DESC, orders.orderdate
=== PLAN ===
SORT[revenue DESC, orders.orderdate ASC] {
  PROJECT [orderkey: __lineitem::orderkey, revenue: ___INTERNAL_AGG_1, orderdate: __orders::orderdate, shippriority: __orders::shippriority] {
    AGGREGATE [__lineitem::orderkey: lineitem.orderkey, __orders::orderdate: orders.orderdate, __orders::shippriority: orders.shippriority, ___INTERNAL_AGG_1: SUM(lineitem.extendedprice * 1 - lineitem.discount)] {
      SELECT[customer.mktsegment = 'BUILDING' AND customer.custkey = orders.custkey AND lineitem.orderkey = orders.orderkey AND orders.orderdate < DATE('1995-03-15') AND lineitem.shipdate > DATE('1995-03-15')] {
        CROSS PRODUCT {
          CROSS PRODUCT {
            SCAN [CUSTOMER(custkey, name, address, nationkey, phone, acctbal, mktsegment, comment)], 
            SCAN [ORDERS(orderkey, custkey, orderstatus, totalprice, orderdate, orderpriority, clerk, shippriority, comment)]
          }, 
          SCAN [LINEITEM(orderkey, partkey, suppkey, linenumber, quantity, extendedprice, discount, tax, returnflag, linestatus, shipdate, commitdate, receiptdate, shipinstruct, shipmode, comment)]
        }
      }
    }
  }
}
CLAUSE: lineitem.shipdate > DATE('1995-03-15')
   COLUMNS:[lineitem.shipdate]
  Push-down right
CLAUSE: orders.orderdate < DATE('1995-03-15')
   COLUMNS:[orders.orderdate]
  Push-down left
CLAUSE: lineitem.orderkey = orders.orderkey
   COLUMNS:[lineitem.orderkey, orders.orderkey]
  Keep it there!
CLAUSE: customer.mktsegment = 'BUILDING'
   COLUMNS:[customer.mktsegment]
  Push-down left
CLAUSE: customer.custkey = orders.custkey
   COLUMNS:[customer.custkey, orders.custkey]
  Push-down left
CLAUSE: customer.custkey = orders.custkey
   COLUMNS:[customer.custkey, orders.custkey]
  Keep it there!
CLAUSE: orders.orderdate < DATE('1995-03-15')
   COLUMNS:[orders.orderdate]
  Push-down right
CLAUSE: customer.mktsegment = 'BUILDING'
   COLUMNS:[customer.mktsegment]
  Push-down left
=== OPTIMIZED PLAN ===
SORT[revenue DESC, orders.orderdate ASC] {
  PROJECT [orderkey: __lineitem::orderkey, revenue: ___INTERNAL_AGG_1, orderdate: __orders::orderdate, shippriority: __orders::shippriority] {
    AGGREGATE [__lineitem::orderkey: lineitem.orderkey, __orders::orderdate: orders.orderdate, __orders::shippriority: orders.shippriority, ___INTERNAL_AGG_1: SUM(lineitem.extendedprice * 1 - lineitem.discount)] {
      SELECT[lineitem.orderkey = orders.orderkey] {
        CROSS PRODUCT {
          SELECT[customer.custkey = orders.custkey] {
            CROSS PRODUCT {
              SELECT[customer.mktsegment = 'BUILDING'] {
                SCAN [CUSTOMER(custkey, name, address, nationkey, phone, acctbal, mktsegment, comment)]
              }, 
              SELECT[orders.orderdate < DATE('1995-03-15')] {
                SCAN [ORDERS(orderkey, custkey, orderstatus, totalprice, orderdate, orderpriority, clerk, shippriority, comment)]
              }
            }
          }, 
          SELECT[lineitem.shipdate > DATE('1995-03-15')] {
            SCAN [LINEITEM(orderkey, partkey, suppkey, linenumber, quantity, extendedprice, discount, tax, returnflag, linestatus, shipdate, commitdate, receiptdate, shipinstruct, shipmode, comment)]
          }
        }
      }
    }
  }
}
=== RESULTS ===
450|147876.01859999998|1995-03-05|0
577|34178.5628|1994-12-19|0
